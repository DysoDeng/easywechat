"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9553],{97662:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-ac56b430",path:"/4.x/wework/oauth.html",title:"OAuth",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"跳转授权",slug:"跳转授权",children:[]},{level:2,title:"获取授权用户信息",slug:"获取授权用户信息",children:[]}],filePathRelative:"4.x/wework/oauth.md",git:{updatedTime:1629906046e3,contributors:[]}}},27310:(n,s,a)=>{a.r(s),a.d(s,{default:()=>b});var e=a(66252);const p=(0,e._)("h1",{id:"oauth",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#oauth","aria-hidden":"true"},"#"),(0,e.Uk)(" OAuth")],-1),t=(0,e._)("blockquote",null,[(0,e._)("p",null,"{warning} 此文档为企业微信内部应用开发的网页授权")],-1),l={href:"https://work.weixin.qq.com/api/doc#90000/90135/91020",target:"_blank",rel:"noopener noreferrer"},o=(0,e.Uk)("企业微信官方文档"),c=(0,e.uE)('<p>创建实例：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token string single-quoted-string">&#39;corp_id&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;xxxxxxxxxxxxxxxxx&#39;</span><span class="token punctuation">,</span>\n    <span class="token string single-quoted-string">&#39;secret&#39;</span>   <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;xxxxxxxxxx&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 应用的 secret</span>\n    <span class="token string single-quoted-string">&#39;agent_id&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">100001</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token variable">$app</span> <span class="token operator">=</span> <span class="token class-name static-context">Factory</span><span class="token operator">::</span><span class="token function">work</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="跳转授权" tabindex="-1"><a class="header-anchor" href="#跳转授权" aria-hidden="true">#</a> 跳转授权</h2><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// $callbackUrl 为授权回调地址</span>\n<span class="token variable">$callbackUrl</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;https://xxx.xxx&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 需设置可信域名</span>\n\n<span class="token comment">// 返回一个 redirect 实例</span>\n<span class="token variable">$redirect</span> <span class="token operator">=</span> <span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token property">oauth</span><span class="token operator">-&gt;</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token variable">$callbackUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 获取企业微信跳转目标地址</span>\n<span class="token variable">$targetUrl</span> <span class="token operator">=</span> <span class="token variable">$redirect</span><span class="token operator">-&gt;</span><span class="token function">getTargetUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 直接跳转到企业微信授权</span>\n<span class="token variable">$redirect</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="获取授权用户信息" tabindex="-1"><a class="header-anchor" href="#获取授权用户信息" aria-hidden="true">#</a> 获取授权用户信息</h2><p>在回调页面中，你可以使用以下方式获取授权者信息：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token property">oauth</span><span class="token operator">-&gt;</span><span class="token function">detailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 获取用户信息</span>\n<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对应企业微信英文名（userid）</span>\n<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">getOriginal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取企业微信接口返回的原始信息</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',7),r=(0,e.Uk)("获取用户其他信息需调用通讯录接口，参考："),i={href:"https://github.com/EasyWeChat/docs/blob/master/wework/contacts.md",target:"_blank",rel:"noopener noreferrer"},u=(0,e.Uk)("企业微信通讯录API"),k=(0,e._)("div",{class:"language-php ext-php line-numbers-mode"},[(0,e._)("pre",{class:"language-php"},[(0,e._)("code")]),(0,e._)("div",{class:"line-numbers"})],-1),b={render:function(n,s){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.iD)(e.HY,null,[p,t,(0,e._)("p",null,[(0,e._)("a",l,[o,(0,e.Wm)(a)])]),c,(0,e._)("p",null,[r,(0,e._)("a",i,[u,(0,e.Wm)(a)])]),k],64)}}}}]);
//# sourceMappingURL=v-ac56b430.eb29fc30.js.map